import{a as f,b as y,c as D}from"./chunk.js";var c=new Event("flip.start",{bubbles:!0}),u=new Event("flip.reset",{bubbles:!0}),p=new Event("flip.debug",{bubbles:!0});function L(t,e=!1){let n=e?"Debug":"(\u256F\xB0\u25A1\xB0)\u256F\uFE35 \u253B\u2501\u253B",{x:r,y:s}=t.getBoundingClientRect(),i=document.createElement("button");i.innerText=n,i.style.position="absolute",i.style.left=`${r}px`,i.style.top=`${s}px`,i.addEventListener("click",()=>{t.dispatchEvent(e?p:c)}),document.addEventListener(c.type,()=>{i.style.display="none"}),document.addEventListener(p.type,()=>{i.style.display="none"}),document.addEventListener(u.type,()=>{i.style.display="initial"}),document.body.append(i)}function $(){let t=document.createElement("button");t.style.position="fixed",t.style.zIndex="9999",t.style.top="10px",t.style.left="10px",t.style.display="none",t.innerText="Put table back \u252C\u2500\u252C\u30CE( \xBA _ \xBA\u30CE)",t.addEventListener("click",()=>{document.dispatchEvent(u),t.style.display="none"}),document.addEventListener(c.type,()=>{t.style.display="initial"}),document.addEventListener(p.type,()=>{t.style.display="initial"}),document.body.append(t)}var T=new CSSStyleSheet;document.adoptedStyleSheets=[...document.adoptedStyleSheets,T];function C(){T.replaceSync(`
    body {
      overflow: hidden;
    }
  `)}function G(){T.replaceSync("")}var o=f(y());var g=f(y());var Y={x:.1,y:2.1};function z(t,e){g.Events.on(t,"beforeUpdate",n=>{n.timestamp>2e3&&n.timestamp<2500&&ne(e)})}function ne(t){g.Body.applyForce(t,{x:t.bounds.max.x+10,y:t.bounds.max.y},Y)}var N=f(y());function w(t,e){let{x:n,y:r,width:s,height:i}=t.getBoundingClientRect(),l=n+s/2,d=r+i/2;return N.Bodies.rectangle(l,d,s,i,e)}var b=f(y());function q(t,e){return t.group===e.group&&t.group!==0?t.group>0:!t.collidesWith||!e.collidesWith?!1:t.collidesWith?.includes(e.group)&&e.collidesWith?.includes(t.group)}var R=b.Body.nextGroup(!1),I=b.Body.nextGroup(!1),v=b.Body.nextGroup(!1),X={group:R,collidesWith:[I,v]},P={group:I,collidesWith:[R]};function J(t){return{group:v,collidesWith:[t,R]}}function O(t){return{group:t,collidesWith:[v]}}function S(t){return Array.from(t.children).filter(e=>e instanceof HTMLElement).flatMap(e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;if(e.nodeName==="svg")return e;if(e.children.length)return S(e);let n=window.getComputedStyle(e);if(!(n.display==="none"||n.visibility==="hidden")&&(e.textContent||e.nodeName==="img"))return e}).filter(e=>e!==void 0)}o.Detector.canCollide=q;var h=class{engine;runner;renderer;constructor(){this.engine=o.Engine.create(),this.runner=o.Runner.create()}flip(e,n){this.renderer=new n(this.engine);let{bottom:r}=e.getBoundingClientRect(),s=20,i=o.Bodies.rectangle(window.innerWidth/2,r+s/2,window.innerWidth*2,s,{isStatic:!0});i.collisionFilter=X;let l=w(e,{mass:80,inverseMass:1/80});l.collisionFilter=P;let d=o.Composite.create({label:"table",bodies:[l]}),K=S(e),H=[],k=[];for(let B of K){let V=o.Body.nextGroup(!1),W=Math.random()*4+1,m=w(B,{label:"leaf",mass:W,inverseMass:1/W});o.Body.scale(m,.8,.9,{x:m.position.x,y:m.bounds.max.y}),m.collisionFilter=J(V),H.push(m),k.push({body:m,elem:B});let{left:Q,bottom:Z,width:A}=B.getBoundingClientRect(),a=o.Bodies.rectangle(Q+A/2,Z,A,1,{label:"shelf",density:.1});a.collisionFilter=O(V);let ee=o.Constraint.create({bodyA:l,bodyB:a,pointA:{x:a.bounds.min.x-l.position.x,y:a.position.y-l.position.y},pointB:{x:a.bounds.min.x-a.position.x,y:0},length:0}),te=o.Constraint.create({bodyA:l,bodyB:a,pointA:{x:a.bounds.max.x-l.position.x,y:a.position.y-l.position.y},pointB:{x:a.bounds.max.x-a.position.x,y:0},length:0});o.Composite.add(d,a),o.Composite.add(d,ee),o.Composite.add(d,te)}o.Composite.add(this.engine.world,[d,...H,i]),z(this.engine,l),this.renderer.start({body:l,elem:e},k),o.Runner.run(this.runner,this.engine)}stop(){this.renderer?.stop(),o.Runner.stop(this.runner),o.World.clear(this.engine.world,!1),o.Engine.clear(this.engine),this.engine.timing={...this.engine.timing,timestamp:0,lastDelta:0,lastElapsed:0}}};var E=f(y());var F=class extends D{#e;#t=[];start(e,n){let r=new M(e.elem,e.body);this.#t.push(r),this.#t.push(...n.map(s=>new M(s.elem,s.body,r))),this.#e=requestAnimationFrame(()=>this.#n())}#n(){for(let e of this.#t)e.render();this.#e=requestAnimationFrame(()=>this.#n())}stop(){this.#e&&cancelAnimationFrame(this.#e);for(let e of this.#t)e.reset()}},M=class{elem;container;body;#e;#t;#n;#o;#i;constructor(e,n,r){this.elem=e,this.container=r,this.body=n;let{x:s,y:i,width:l,height:d}=e.getBoundingClientRect();this.#t=l,this.#e=d,this.#n=E.Vector.create(s,i),this.#o=E.Vector.create(s+l/2,i+d/2),this.#i=this.elem.style.cssText,this.elem.style.position="relative",this.elem.style.transition="none"}render(){let{parentRotationTranslation:e,parentRotation:n,parentTranslation:r,translation:s,rotation:i}=this.transform();this.elem.style.transform=`
      rotate(${-n}rad)
      translate(${-e.x}px, ${-e.y}px)
      translate(${-r.x}px, ${-r.y}px)
      translate(${s.x}px, ${s.y}px)
      rotate(${i}rad)
    `}transform(){let e;if(this.container){let n=this.#o.x-this.container.#o.x,r=this.#o.y-this.container.#o.y,s=this.container.body.angle,[i,l]=[n*Math.cos(s)-r*Math.sin(s),n*Math.sin(s)+r*Math.cos(s)];e={x:i-n,y:l-r}}return{parentRotationTranslation:e||E.Vector.create(0,0),parentRotation:this.container?.body.angle||0,parentTranslation:{x:this.container?.translateX()||0,y:this.container?.translateY()||0},translation:{x:this.translateX(),y:this.translateY()},rotation:this.body.angle}}translateX(){return this.body.position.x-this.#n.x-this.#t/2}translateY(){return this.body.position.y-this.#n.y-this.#e/2}reset(){this.elem.style.cssText=this.#i}};var x;async function j(t=!1){if(document.addEventListener(c.type,e=>{e.target instanceof HTMLElement&&(C(),x=new h,x.flip(e.target,F))}),t){let{DebugRenderer:e}=await import("./debug.js");document.addEventListener(p.type,n=>{n.target instanceof HTMLElement&&(C(),x=new h,x.flip(n.target,e))})}document.addEventListener(u.type,()=>{G(),x?.stop()})}async function ke({tableSelector:t,debug:e=!1}){let n=document.querySelectorAll(t);for(let r of n)r instanceof HTMLElement&&(L(r),e&&L(r,e));$(),await j(e),console.log("%cYOU MAY FLIP WHEN READY \u{1FAE1}","background-color: aquamarine; color: black; font-size: 2rem"),console.log("%cFor best results, close DevTools before flipping.","font-style: italic; font-size: 1.2rem")}export{ke as setup};
